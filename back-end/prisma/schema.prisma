generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(cuid())
  name       String
  email      String   @unique
  password   String
  role       UserRole @default(CUSTOMER)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  bookings   Booking[]  @relation("clientBookings")
  reviews    Review[]
}

model Provider {
  id         String   @id @default(cuid())
  name       String
  email      String   @unique
  password   String
  bio        String?
  phone      String?
  city       String?
  neighborhood String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  services    Service[]
  availabilities Availability[]
  bookings    Booking[] @relation("providerBookings")
  notifications Notification[]
  reviews     Review[]
}

model ServiceType {
  id    String @id @default(cuid())
  name  String @unique
  slug  String @unique
  services Service[]
}

model Service {
  id          String    @id @default(cuid())
  providerId  String
  provider    Provider  @relation(fields: [providerId], references: [id])
  typeId      String?
  type        ServiceType? @relation(fields: [typeId], references: [id])
  name        String
  description String?
  photos      String[]  
  active      Boolean   @default(true)

  variations  ServiceVariation[]
  bookings    Booking[]  
  review Review[]
}

model ServiceVariation {
  id             String   @id @default(cuid())
  serviceId      String
  service        Service  @relation(fields: [serviceId], references: [id])
  name           String
  price          Decimal  @db.Decimal(10,2)
  durationMinutes Int
  createdAt      DateTime @default(now())

  bookings       Booking[]
}

model Availability {
  id         String  @id @default(cuid())
  providerId String
  provider   Provider @relation(fields: [providerId], references: [id])

  // Recurring rule example (weekday)
  weekday    Int?     // 0 = Sunday .. 6 = Saturday
  startTime  String?  // "09:00"
  endTime    String?  // "12:00"

  // OR specific slot
  startAt    DateTime?
  endAt      DateTime?
}

model Booking {
  id           String   @id @default(cuid())
  clientId     String
  client       User     @relation("clientBookings", fields: [clientId], references: [id])
  providerId   String
  provider     Provider @relation("providerBookings", fields: [providerId], references: [id])

  serviceId    String
  service      Service  @relation(fields: [serviceId], references: [id])

  variationId  String
  variation    ServiceVariation @relation(fields: [variationId], references: [id])

  startAt      DateTime
  endAt        DateTime
  status       BookingStatus  @default(CONFIRMED)
  createdAt    DateTime @default(now())
  canceledAt   DateTime?

  // metadata, price final etc
  price        Decimal? @db.Decimal(10,2)
}

model Notification {
  id         String   @id @default(cuid())
  providerId String
  provider   Provider @relation(fields: [providerId], references: [id])
  type       String
  message    String
  read       Boolean  @default(false)
  metadata   Json?
  createdAt  DateTime @default(now())
}

model Review {
  id         String   @id @default(cuid())
  clientId   String
  client     User     @relation(fields: [clientId], references: [id])
  providerId String?
  provider   Provider? @relation(fields: [providerId], references: [id])
  serviceId  String?
  service    Service?  @relation(fields: [serviceId], references: [id])
  rating     Int
  comment    String?
  createdAt  DateTime @default(now())
}

enum UserRole {
  CUSTOMER
  PROVIDER
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}
